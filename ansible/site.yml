# ansible/site.yml
---
- name: ðŸš€ Multi-Platform Provisioning Entry Point
  hosts: all
  gather_facts: yes
  become: yes

  vars_files:
    - "config/group_vars/all.yml"
    - "config/group_vars/{{ ansible_os_family | lower }}.yml"
    - "{{ vault_file | default('secrets/ansible-vault/' + ansible_os_family | lower + '.yml') }}"

  pre_tasks:
    - name: "ðŸ“¦ Show detected platform info"
      debug:
        msg: "OS Family: {{ ansible_os_family }}, Distribution: {{ ansible_distribution }}, Kernel: {{ ansible_kernel }}"

  roles:
    - { role: base, tags: ['base'] }

  tasks:
    - name: "ðŸ—­ Include Ubuntu playbook"
      ansible.builtin.import_playbook: "playbooks/ubuntu/main.yml"
      when: ansible_distribution == "Ubuntu"

    - name: "ðŸ—­ Include Arch playbook"
      ansible.builtin.import_playbook: "playbooks/arch/main.yml"
      when: ansible_distribution == "Archlinux"

    - name: "ðŸ—­ Include macOS playbook"
      ansible.builtin.import_playbook: "playbooks/darwin/main.yml"
      when: ansible_system == "Darwin"

    - name: "ðŸ—­ Include Windows playbook"
      ansible.builtin.import_playbook: "playbooks/windows/main.yml"
      when: ansible_os_family == "Windows"

    - name: "ðŸ—­ Include WSL playbook"
      ansible.builtin.import_playbook: "playbooks/wsl/main.yml"
      when: ansible_kernel | lower is search("microsoft")
