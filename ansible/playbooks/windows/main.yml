---
- name: Configure Windows system
  hosts: windows
  gather_facts: true
  vars_files:
    - "../../config/group_vars/all.yml"
    - "../../config/group_vars/windows.yml"
    - "{{ vault_file | default('secrets/ansible-vault/windows.yml') }}"

  tasks:
    - name: Include core packages installation
      include_tasks: tasks/packages.yml
      tags: packages

    - name: Apply system configuration
      include_tasks: tasks/config.yml
      tags: config

    - name: Apply security hardening
      include_tasks: tasks/security.yml
      when: security_hardening_enabled
      tags: security

    - name: Configure developer tools
      include_tasks: tasks/dev_tools.yml
      when: user_role == "developer"
      tags: development

  handlers:
    - name: Reboot system
      win_reboot:
        msg: "Reboot initiated by Ansible"
        connect_timeout: 5
        reboot_timeout: 600
